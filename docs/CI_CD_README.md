# CI/CD GitHub Actions 設定

このリポジトリには、コード品質とセキュリティを自動的にチェックするGitHub Actionsワークフローが設定されています。

## 実装されているワークフロー

### 1. CI - コード品質・セキュリティチェック (`.github/workflows/ci.yml`)

すべてのプルリクエストと`main`、`develop`ブランチへのプッシュで実行されます。

**含まれる機能:**
- **セキュリティスキャン**: CodeQLを使用した高度なセキュリティ分析
- **コード品質チェック**: ESLintによるJavaScript/Google Apps Scriptのコード品質チェック
- **ファイル構造検証**: 必須ディレクトリとドキュメントの存在確認
- **シークレットスキャン**: ハードコードされたAPI キーやパスワードの検出
- **VBA 分析**: VBAファイルのセキュリティリスク検出

### 2. セキュリティ詳細分析 (`.github/workflows/security.yml`)

週1回（日曜日）と`main`ブランチへのプッシュで実行される詳細なセキュリティ分析です。

**含まれる機能:**
- **高度なシークレットスキャン**: 様々なAPI キー形式の検出
- **権限・スコープ分析**: Google Apps ScriptとVBAの権限設定チェック
- **依存関係脆弱性チェック**: npm依存関係の脆弱性スキャン
- **ファイル整合性チェック**: 疑わしいファイルの検出

## 開発者向け情報

### ローカルでのコード品質チェック

```bash
# 依存関係のインストール
npm install

# コードのリンティング
npm run lint

# セキュリティ監査
npm run security
```

### 設定ファイル

- **ESLint設定**: `.eslintrc.json` - JavaScript/Google Apps Scriptのコーディング規約
- **パッケージ管理**: `package.json` - 開発依存関係の管理
- **除外設定**: `.gitignore` - バージョン管理から除外するファイル

### CI/CDで検出される可能性のある問題

#### セキュリティ関連
- ハードコードされたAPI キー、パスワード、トークン
- 過度に強力な権限設定
- 危険なVBA関数の使用（Shell、WScript.Shellなど）
- 依存関係の既知の脆弱性

#### コード品質関連
- 未使用変数
- 未定義変数の使用
- 推奨されない比較演算子の使用

### セキュリティベストプラクティス

1. **API キーの管理**
   - API キーはコード内にハードコーディングしない
   - `YOUR_API_KEY_HERE` のようなプレースホルダーを使用
   - 本番環境では設定ファイルや環境変数を使用

2. **VBA セキュリティ**
   - Shell関数やWScript.Shellの使用を最小限に
   - ファイルシステムアクセスは必要最小限に留める

3. **権限管理**
   - Google Apps Scriptのスコープは必要最小限に設定
   - 定期的に権限設定を見直す

## トラブルシューティング

### CI/CDが失敗した場合

1. **セキュリティスキャンの失敗**
   - ハードコードされたシークレットを削除
   - 設定ファイルまたは環境変数の使用を検討

2. **コード品質チェックの失敗**
   - ESLintエラーを修正
   - `npm run lint:fix` で自動修正可能な問題を解決

3. **VBA 分析の警告**
   - 危険な関数の使用を見直し
   - セキュリティ上の理由を文書化

### サポート

CI/CDの設定や問題について質問がある場合は、Issueを作成してください。

## 今後の拡張予定

- [ ] 自動テスト実行の追加
- [ ] デプロイメント自動化
- [ ] パフォーマンステストの追加
- [ ] ドキュメント自動生成