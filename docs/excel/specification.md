# Excel AI機能 - 機能仕様書

## 1. システム概要

### 1.1 目的
EXCELでのAI活用による作業効率化を実現し、表の行単位処理やセルの関数生成を自動化する。

### 1.2 システム名称
**Excel AI Helper** - Excel用AI支援アドイン

### 1.3 対象環境
- Microsoft Excel 2016以降
- Windows 10/11
- Azure OpenAI API接続環境

## 2. 機能要件

### 2.1 表の行単位AI処理機能

#### 2.1.1 機能概要
選択した表の各行データをAIに送信し、指定した観点で分析結果を取得する機能。

#### 2.1.2 具体的な処理フロー
1. **データ選択**
   - ユーザーが分析対象の表範囲を選択
   - ヘッダー行の自動認識
   - データ行の抽出

2. **分析設定**
   - 分析観点の選択（プリセット or カスタム）
   - 出力形式の指定（数値、テキスト、スコアなど）
   - 結果列の指定

3. **AI分析実行**
   - 各行データをAIプロンプトに組み込み
   - Azure OpenAI APIに送信
   - 結果の受信と検証

4. **結果出力**
   - 指定した列に分析結果を挿入
   - エラー行のハイライト表示
   - 処理完了レポートの表示

#### 2.1.3 分析プリセット例
- **学習意欲判定**: 参加動機・学習内容から0-10のスコア算出
- **感情分析**: テキストの感情ポジティブ/ネガティブ判定
- **カテゴリ分類**: 自由記述内容の自動カテゴリ分類
- **要約生成**: 長文テキストの要約作成

#### 2.1.4 入力制限
- 最大処理行数: 1000行
- 1行あたりの最大文字数: 2000文字
- 1回の処理時間制限: 10分

### 2.2 セルのAI関数生成機能

#### 2.2.1 機能概要
選択したセル範囲の内容を基に、ユーザーの要求に応じた関数やデータ変換を生成する機能。

#### 2.2.2 具体的な処理フロー
1. **セル選択**
   - 処理対象のセル範囲を選択
   - セル内容の取得と検証

2. **プロンプト編集**
   - 専用ダイアログでプロンプト作成
   - プレビュー機能で結果イメージ確認
   - 生成例の参照機能

3. **AI処理実行**
   - セル内容とプロンプトをAIに送信
   - 関数またはデータの生成
   - 結果の妥当性検証

4. **結果適用**
   - 生成された関数/データをセルに挿入
   - 適用前の確認ダイアログ表示
   - 元に戻す機能の提供

#### 2.2.3 生成可能な内容
- **Excel関数**: VLOOKUP、SUMIFS等の複雑な関数
- **データ変換**: 日付形式変換、文字列整形
- **計算式**: 複雑な計算ロジックの自動生成
- **データ補完**: 欠損値の推定補完

### 2.3 設定管理機能

#### 2.3.1 API設定
- Azure OpenAI エンドポイント設定
- APIキー管理（暗号化保存）
- モデル選択（GPT-4、GPT-3.5-turbo等）
- タイムアウト設定

#### 2.3.2 プロンプト管理
- カスタムプロンプトテンプレートの保存
- プリセットプロンプトの編集
- プロンプト履歴の管理

#### 2.3.3 動作設定
- 処理進捗表示の詳細レベル
- エラー時の動作選択
- ログ出力レベル

## 3. 非機能要件

### 3.1 性能要件
- 100行以下の処理: 1分以内完了
- レスポンス時間: ユーザー操作から3秒以内で開始
- メモリ使用量: 追加メモリ使用量は100MB以下

### 3.2 セキュリティ要件
- APIキーの暗号化保存
- 通信時のHTTPS使用
- 個人情報を含むデータの警告表示
- ログファイルでの機密情報除外

### 3.3 可用性要件
- API接続エラー時の適切なエラーハンドリング
- ネットワーク切断時の処理継続機能
- 処理中断時の状態復旧機能

### 3.4 互換性要件
- Excel 2016, 2019, 2021, Microsoft 365対応
- 日本語環境での正常動作
- 他のアドインとの競合回避

## 4. ユーザーインターフェース要件

### 4.1 リボンメニュー構成
```
「AI Helper」タブ
├── 表処理グループ
│   ├── 行分析実行
│   ├── 分析設定
│   └── プリセット選択
├── セル処理グループ
│   ├── AI関数生成
│   ├── プロンプト編集
│   └── 変換実行
└── 設定グループ
    ├── API設定
    ├── プロンプト管理
    └── システム情報
```

### 4.2 ダイアログ設計
- **分析設定ダイアログ**: プリセット選択、カスタム設定
- **プロンプト編集ダイアログ**: リッチテキスト編集、プレビュー
- **API設定ダイアログ**: ガイド付き設定ウィザード
- **進捗表示ダイアログ**: リアルタイム進捗、キャンセル機能

### 4.3 ユーザビリティ要件
- 日本語での統一されたメッセージ表示
- 操作手順の分かりやすいガイダンス
- エラー時の具体的な解決方法提示
- キーボードショートカット対応

## 5. データ要件

### 5.1 設定データ保存
- レジストリまたは設定ファイルでの永続化
- ユーザープロファイル別の設定管理
- 設定のエクスポート/インポート機能

### 5.2 処理データ制限
- 1回の処理でのデータサイズ上限: 10MB
- プロンプト長の上限: 4000文字
- 結果データの最大サイズ: 1MB/セル

### 5.3 ログデータ
- 処理実行ログの保存（30日間）
- エラーログの詳細記録
- 使用統計データの収集（オプション）

## 6. システム間連携

### 6.1 Azure OpenAI API連携
- REST API経由での通信
- 適切なエラーハンドリング
- レート制限への対応

### 6.2 Excel連携
- VBA Application Object経由でのワークシート操作
- イベントハンドラーでの状態監視
- アドイン間での名前空間分離

## 7. 制約事項

### 7.1 技術的制約
- VBAの処理速度制限
- Excel API の機能制限
- Azure OpenAI の利用制限

### 7.2 運用制約
- インターネット接続必須
- Azure OpenAI サブスクリプション必要
- Excel マクロセキュリティ設定必要

## 8. 将来拡張予定

### 8.1 機能拡張
- 他のAIサービス対応（OpenAI、Claude等）
- 画像認識機能の追加
- 音声入力対応

### 8.2 連携拡張
- Power BI との連携
- SharePoint との連携
- Teams アプリとしての提供