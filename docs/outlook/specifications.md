# Outlook OpenAI マクロ システム仕様書

## 1. システム概要

### 1.1 目的
Outlook でのメール処理を Azure OpenAI API を活用して快適化し、業務効率を向上させる。

### 1.2 対象ユーザー
- PTA関係者および一般的なビジネスメールユーザー
- Outlook を日常的に使用するユーザー

### 1.3 システム構成
- プラットフォーム: Microsoft Outlook (VBA)
- AI エンジン: Azure OpenAI API (GPT-4)
- 配布形式: VBA モジュール (.bas ファイル)

## 2. 機能仕様

### 2.1 メール内容解析機能 (AI_EmailAnalyzer)

#### 2.1.1 転送メール内容抽出
- **機能**: 複数回転送されたメールから元の内容を抽出
- **入力**: 選択されたメールアイテム
- **処理**: 
  - メール本文から転送履歴を解析
  - 最初の送信者と本来の内容を特定
  - AI による内容要約を実行
- **出力**: 要約された元メール内容をメッセージボックスまたは新規メールで表示

#### 2.1.2 メール内容明確化
- **機能**: 枕詞や挨拶を除去して核心的な内容を抽出
- **入力**: 選択されたメールアイテム
- **処理**:
  - ビジネスメールの定型文を識別
  - 重要な情報（期限、対象者、アクション項目）を抽出
  - 内容の要約と構造化
- **出力**: 構造化された要約（期限、対象者、アクション項目別）

#### 2.1.3 重要情報抽出
- **機能**: メールから期限、対象者、アクション項目を自動抽出
- **入力**: メール本文テキスト
- **処理**:
  - 日付表現の抽出と標準化
  - 人名・組織名の抽出
  - タスク・アクション項目の識別
- **出力**: JSON形式の構造化データ

### 2.2 メール作成支援機能 (AI_EmailComposer)

#### 2.2.1 営業メール断り作成
- **機能**: 営業メールに対する丁寧な断りメールを自動生成
- **入力**: 
  - 元の営業メール
  - 断り理由（オプション）
- **処理**:
  - 営業内容の分析
  - 適切な敬語と断り文面の生成
  - 送信者に配慮した内容調整
- **出力**: 返信用メールの下書き作成

#### 2.2.2 肯定ビジネスメール作成
- **機能**: 承諾・同意の返信メールを自動生成
- **入力**:
  - 元のメール
  - 承諾内容の詳細（オプション）
- **処理**:
  - 要求内容の理解と確認
  - 適切なビジネス文体での返信生成
  - 次のアクションの提案
- **出力**: 返信用メールの下書き作成

### 2.3 検索・分析機能 (AI_SearchAnalyzer)

#### 2.3.1 検索フォルダ分析
- **機能**: 既存の検索フォルダの使用状況を分析
- **入力**: Outlook の検索フォルダリスト
- **処理**:
  - 各検索フォルダのメール件数分析
  - 最終更新日時の確認
  - 重複する条件の検出
- **出力**: 分析結果レポート（不要フォルダの推奨削除リスト）

#### 2.3.2 フォルダ状況分析
- **機能**: 新しい検索フォルダ作成時の対象フォルダ分析
- **入力**: 分析対象フォルダ
- **処理**:
  - メール分類の傾向分析
  - 送信者別統計
  - 時系列トレンド分析
- **出力**: 推奨検索条件の提案

## 3. 技術仕様

### 3.1 VBA モジュール構成

```
OutlookAIHelper/
├── AI_EmailAnalyzer.bas      # メール解析機能
├── AI_EmailComposer.bas      # メール作成支援
├── AI_SearchAnalyzer.bas     # 検索・分析機能
├── AI_ConfigManager.bas      # 設定管理
├── AI_Common.bas            # 共通関数・定数
└── AI_ApiConnector.bas      # OpenAI API接続
```

### 3.2 OpenAI API 連携仕様

#### 3.2.1 認証
- **方式**: Bearer Token 認証
- **API Key**: 設定ファイルまたはVBA定数で管理
- **エンドポイント**: Azure OpenAI Service

#### 3.2.2 リクエスト仕様
```json
{
  "model": "gpt-4",
  "messages": [
    {
      "role": "system",
      "content": "あなたは日本語のビジネスメール処理の専門家です。"
    },
    {
      "role": "user", 
      "content": "メール内容を解析してください: [メール本文]"
    }
  ],
  "max_tokens": 1000,
  "temperature": 0.3
}
```

#### 3.2.3 エラーハンドリング
- API制限エラーの対応
- ネットワークエラーの対応
- レスポンス形式エラーの対応
- ユーザーフレンドリーなエラーメッセージ

### 3.3 設定管理

#### 3.3.1 設定項目
- OpenAI API Key
- API エンドポイント URL
- プロンプトテンプレート
- 出力形式設定
- ログレベル

#### 3.3.2 設定保存方式
- **主要案**: VBA内定数 (開発初期)
- **将来案**: レジストリまたは設定ファイル

## 4. ユーザーインターフェース

### 4.1 マクロメニュー構成
```
Outlook マクロメニュー
├── AI メール解析
│   ├── 転送内容を抽出
│   ├── 内容を明確化
│   └── 重要情報を抽出
├── AI メール作成
│   ├── 営業断りメールを作成
│   └── 承諾メールを作成
├── 検索フォルダ分析
│   ├── 使用状況を分析
│   └── 新規作成を支援
└── 設定
    └── API設定を変更
```

### 4.2 実行フロー
1. ユーザーがメールを選択
2. マクロメニューから機能を選択
3. 必要に応じて追加パラメータを入力
4. AI処理実行（プログレス表示）
5. 結果の表示・適用

## 5. セキュリティ要件

### 5.1 データ保護
- メール内容の一時的なキャッシュは最小限に抑制
- API通信の暗号化 (HTTPS)
- 機密情報の自動検出と除外

### 5.2 API Key 管理
- ハードコーディングの回避（本番運用時）
- 設定ファイルまたはレジストリでの安全な保存
- ユーザーによる個別設定の推奨

## 6. パフォーマンス要件

### 6.1 レスポンス時間
- メール解析: 10秒以内
- メール作成: 15秒以内
- 検索分析: 30秒以内

### 6.2 制限事項
- 同時処理: 1件ずつの順次処理
- 大容量メール: 50KB以上のメールは警告表示
- API制限: レート制限の考慮（1分間に60リクエスト）

## 7. 配布・インストール

### 7.1 配布形式
- **.bas ファイル**: 各機能モジュール
- **README.txt**: インストール手順
- **config-template.bas**: 設定テンプレート

### 7.2 インストール手順
1. Outlook VBA エディタを開く
2. 各.basファイルをインポート
3. API設定を入力
4. マクロセキュリティ設定を確認
5. 動作テストを実行