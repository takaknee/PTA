# Gmail整理スクリプト

このスクリプトは、Gmailの整理を自動化するためのGoogle Apps Scriptです。以下の機能を提供します：

- プロモーションカテゴリのメールを一括削除
- 一年以上前のメールを一括削除
- 送信元別メール分析（受信トレイの送信元をグルーピングし、数の多い順で表示）
- 特定ラベルのメールを一括削除
- 現在のラベル一覧と各ラベルのメール数を表示
- 定期的な自動メール整理の設定

## 設定方法

1. Google スプレッドシートを新規作成します
2. メニューから「拡張機能」→「Apps Script」を選択します
3. Apps Scriptプロジェクトが開いたら、次の2つのファイルを作成してください：
   - `cleanupEmails.gs` - 基本的なメール削除機能
   - `scheduledCleanup.gs` - 定期実行用の設定

4. それぞれのファイルに、このリポジトリの対応するファイルの内容をコピーしてください
5. スプレッドシートに戻り、更新してください（F5キー）
6. スプレッドシートに「Gmail整理」という新しいメニューが表示されます

## 使い方

### 手動実行

スプレッドシート上部の「Gmail整理」メニューから以下の操作が可能です：

- **プロモーションメールを削除**: プロモーションカテゴリに分類されているメールを削除します
- **一年以上前のメールを削除**: 現在の日付から一年以上前のメールをすべて削除します
- **送信元別メール分析**: 受信トレイのメールを送信元別に分析し、数の多い順でスプレッドシートに表示します
- **ラベル一覧を表示**: 全てのラベルとそれに関連するメール数をスプレッドシートに表示します
- **特定ラベルのメールを削除**: 指定したラベルがついているメールを削除します

### 自動実行の設定

定期的に自動削除を設定するには：

1. Apps Scriptエディタで `scheduledCleanup.gs` ファイルを開きます
2. `TARGET_LABELS` 配列に削除対象のラベル名を追加します（例: `const TARGET_LABELS = ['Ads', 'Newsletter'];`）
3. Apps Scriptエディタで `setupDailyTrigger` 関数を実行します
4. 必要な権限を許可します
5. これにより、毎日午前2時に自動でクリーンアップが実行されるようになります

## セキュリティと注意事項

- このスクリプトは、指定したメールを完全に削除します（ゴミ箱に移動します）
- 削除操作は元に戻せないため、削除前に重要なメールがないか確認してください
- メール数が多い場合、Gmail APIの制限により一回の実行で全てを処理できないことがあります
- その場合は、複数回実行するか、定期実行を設定してください

## トラブルシューティング

エラーが発生した場合は：

1. Apps Scriptエディタのログ（「表示」→「ログ」）を確認してください
2. 必要な権限がすべて許可されているか確認してください
3. Gmail APIの制限（1日あたりの操作数など）に達していないか確認してください

### 認可権限の問題が発生した場合

「実行許可がなく実行できません」などのエラーが表示される場合：

1. **権限を再度リクエスト**：
   - スプレッドシートで「Gmail整理」メニューの機能を再度クリック
   - 「権限を確認」ボタンをクリックして認証フローを開始
   - 「詳細」→「安全ではないページに移動」→「許可」の順にクリック
   
2. **認証情報をリセット**：
   - [Google アカウントのセキュリティ設定](https://myaccount.google.com/security)を開く
   - 「セキュリティ」→「アプリのパスワードとアクセス権」でこのアプリを見つけて削除
   - スクリプトを実行し直して新しく権限を許可
   
3. **スクリプトエディタで認証情報をクリア**：
   - Apps Scriptエディタで「編集」→「プロジェクトのプロパティ」を選択
   - 「スクリプトのプロパティ」タブで認証関連の項目を削除

4. **詳細な手順**：より詳しい認可権限の再設定方法については、`auth_reset_instructions.md`ファイルを参照してください

---

Copyright (c) 2025 Your Organization
