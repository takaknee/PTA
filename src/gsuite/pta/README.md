# PTA情報配信システム

このシステムは、PTA（Parent-Teacher Association）における情報配信を効率化するためのGoogle Apps Scriptです。以下の機能を提供します：

## 主な機能

### 1. メンバー管理
- PTA参加者の登録・管理
- メンバーステータス管理（アクティブ、非アクティブ、退会）
- メンバーリストのエクスポート機能
- 参加・脱退の管理

### 2. 情報配信
- アクティブなメンバーへの一括メール配信
- 配信履歴の管理と統計情報
- メールテンプレートの作成・管理
- バッチ処理による効率的な配信

### 3. アンケート管理
- Googleフォームを活用したアンケートの作成
- アンケートの配信と回答催促
- 回答結果の自動集計と表示
- アンケート結果概要の配信機能

### 4. スケジュール通知
- イベント通知の送信
- Googleカレンダー連携
- 定期配信の設定と自動実行
- 参加確認（RSVP）機能

## 設定方法

### 1. Google スプレッドシートの準備

1. 新しいGoogle スプレッドシートを作成します
2. メニューから「拡張機能」→「Apps Script」を選択します
3. Apps Scriptプロジェクトが開いたら、以下のファイルを作成してください：
   - `ptaCore.gs` - メインシステムとメニュー
   - `memberManagement.gs` - メンバー管理機能
   - `informationDistribution.gs` - 情報配信機能
   - `surveyManagement.gs` - アンケート管理機能
   - `scheduleNotifications.gs` - スケジュール通知機能

4. それぞれのファイルに、このリポジトリの対応するファイルの内容をコピーしてください
5. `appsscript.json`の内容もコピーして設定してください

### 2. 権限の設定

このシステムには以下の権限が必要です：

- **Gmail API**: メール送信機能
- **Spreadsheets API**: データ管理
- **Forms API**: アンケート機能
- **Drive API**: ファイル操作
- **Calendar API**: カレンダー連携
- **Script Container UI**: ユーザーインターフェース

### 3. 初期設定の実行

1. スプレッドシートに戻り、ページを更新してください（F5キー）
2. 「PTA情報配信システム」という新しいメニューが表示されます
3. メニューから「システム」→「初期設定を実行」を選択します
4. 必要な権限を許可します
5. 初期設定が完了すると、必要なシートが自動作成されます

## 使い方

### メンバー管理

#### 新しいメンバーの追加
1. 「メンバー管理」→「新しいメンバーを追加」を選択
2. 氏名とメールアドレスを入力
3. 自動的にメンバーIDが生成され、ステータスは「アクティブ」に設定されます

#### メンバーステータスの更新
1. 「メンバー管理」→「メンバーステータスを更新」を選択
2. 更新するメンバーのメールアドレスを入力
3. 新しいステータス（アクティブ、非アクティブ、退会）を選択

#### メンバーリストの確認
1. 「メンバー管理」→「メンバー一覧を表示」を選択
2. メンバー管理シートがアクティブになり、統計情報が表示されます

### 情報配信

#### 通常の情報配信
1. 「情報配信」→「情報をメール配信」を選択
2. 件名と本文を入力
3. 送信確認後、アクティブなメンバー全員にメールが送信されます

#### テンプレートの使用
1. 「情報配信」→「配信テンプレートを管理」を選択
2. 新しいテンプレートを作成するか、既存のテンプレートを使用
3. テンプレートを使用してメール配信が可能

#### 配信履歴の確認
1. 「情報配信」→「配信履歴を確認」を選択
2. 配信履歴シートで過去の配信実績を確認できます

### アンケート管理

#### アンケートの作成
1. 「アンケート管理」→「新しいアンケートを作成」を選択
2. アンケートタイトル、説明、締切日を入力
3. 質問を追加（テキスト入力、選択肢、評価スケールなど）
4. Googleフォームが自動作成されます

#### アンケートの配信
1. 「アンケート管理」→「アンケートを配信」を選択
2. 配信するアンケートを選択
3. アクティブなメンバーにアンケートURLが含まれたメールが送信されます

#### 結果の確認と共有
1. 「アンケート管理」→「アンケート結果を確認」を選択
2. 結果が専用シートに表示されます
3. 「結果概要を配信」で統計情報をメンバーに共有可能

### スケジュール通知

#### イベント通知の送信
1. 「スケジュール」→「イベント通知を送信」を選択
2. イベント名、日時、場所、詳細を入力
3. 参加確認（RSVP）の必要性を選択
4. オプションでGoogleカレンダーにイベントを追加

#### 定期配信の設定
1. 「スケジュール」→「定期配信を設定」を選択
2. 配信名、頻度（毎日、毎週、毎月）、時刻を設定
3. 使用するメールテンプレートを選択
4. 自動的にトリガーが設定され、定期配信が開始されます

## データ構造

### PTAメンバーシート
| 列 | 内容 | 説明 |
|---|---|---|
| A | ID | 自動生成されるメンバーID |
| B | 氏名 | メンバーの氏名 |
| C | メールアドレス | 配信先メールアドレス |
| D | ステータス | アクティブ、非アクティブ、退会 |
| E | 登録日 | メンバー登録日 |
| F | 退会日 | 退会した場合の退会日 |
| G | 備考 | 追加情報 |

### 配信履歴シート
| 列 | 内容 | 説明 |
|---|---|---|
| A | 配信ID | 自動生成される配信ID |
| B | 配信日時 | メール送信日時 |
| C | 件名 | メールの件名 |
| D | 配信タイプ | 情報配信、アンケート配信など |
| E | 配信先数 | 送信対象者数 |
| F | 成功数 | 送信成功数 |
| G | 失敗数 | 送信失敗数 |
| H | 配信者 | 配信を実行したユーザー |
| I | 備考 | 追加情報 |

### アンケート管理シート
| 列 | 内容 | 説明 |
|---|---|---|
| A | アンケートID | 自動生成されるアンケートID |
| B | 作成日 | アンケート作成日 |
| C | タイトル | アンケートタイトル |
| D | フォームURL | GoogleフォームのURL |
| E | ステータス | アクティブ、終了など |
| F | 回答数 | 現在の回答数 |
| G | 締切日 | 回答締切日 |
| H | 作成者 | アンケート作成者 |
| I | 備考 | 追加情報 |

## セキュリティと注意事項

### データ保護
- メンバーの個人情報は適切に管理してください
- スプレッドシートの共有設定を適切に設定してください
- 不要になったデータは適切に削除してください

### メール配信の注意
- 一度に大量のメールを送信する際は、Gmail APIの制限に注意してください
- スパムフィルターに引っかからないよう、適切な件名と本文を心がけてください
- 配信前に必ず内容を確認してください

### API制限
- Gmail API: 1日あたり1,000,000,000件のクォータ
- Forms API: 1日あたり100,000件のリクエスト
- Calendar API: 1日あたり1,000,000件のリクエスト

## トラブルシューティング

### よくある問題

#### 権限エラーが発生する場合
1. Apps Scriptの権限を再度確認してください
2. 必要に応じて権限を再承認してください
3. Googleアカウントの2段階認証設定を確認してください

#### メール送信に失敗する場合
1. 送信先メールアドレスが正しいか確認してください
2. Gmail APIの使用量制限を確認してください
3. 送信元のGoogleアカウントでGmailが有効になっているか確認してください

#### フォーム作成に失敗する場合
1. Google Formsサービスが有効になっているか確認してください
2. 必要な権限が許可されているか確認してください

### ログの確認
1. 「システム」→「システムログを確認」でエラーログを確認できます
2. Apps Scriptエディタの「実行」→「ログ」でも詳細なログを確認できます

### サポート

システムの使用方法や技術的な問題については、以下のリソースを参照してください：

- [Google Apps Script公式ドキュメント](https://developers.google.com/apps-script)
- [Gmail API ドキュメント](https://developers.google.com/gmail/api)
- [Google Forms API ドキュメント](https://developers.google.com/forms/api)

---

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグ報告や機能追加の提案は、GitHubのIssueとして報告してください。