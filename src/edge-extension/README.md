# PTA Edge 拡張機能

PTA 情報配信システムの Edge ブラウザ拡張機能版です。Outlook add-in がポリシーによりインストールできない環境での代替案として開発されています。

## 概要

この拡張機能は、Web 版 Outlook や Gmail でのメール処理に加え、**任意の Web ページでの情報分析機能**を提供する AI 対応ツールです。Azure OpenAI API を活用して、PTA 活動に特化した情報処理機能を提供します。

## 機能

### 🔍 メール解析

- 現在表示されているメールの内容を AI で自動解析
- PTA 活動の観点から重要度とアクション項目を抽出
- 日本語での詳細な解析結果を表示

### 📄 ページ要約・分析

- **任意の Web ページ**の内容を AI で要約・分析
- PTA 活動への関連性を判定し、活用方法を提案
- 重要なポイントとアクション項目を抽出

### 📝 選択テキスト分析

- **ページ内で選択したテキスト**を詳細分析
- 選択範囲に応じた適切な解析とコメント
- PTA 活動での活用方法を具体的に提案

### ✍️ メール作成支援

- お知らせ、リマインダー、アンケート依頼など用途別のメール作成
- AI による自然で丁寧な PTA 向け文面生成
- 複数の作成パターンに対応

### ⚡ クイック機能

- 右クリックメニューからの素早いアクセス
- フローティングボタンによる簡単操作
- 直感的なユーザーインターフェース

### 📊 履歴管理

- AI 処理結果の履歴保存（メール、ページ、選択テキスト全て対応）
- 過去の解析・作成結果の再確認
- エクスポート機能による外部保存

## 対応サービス・サイト

### メール機能対応

- Web 版 Outlook (https://outlook.office.com/)
- Outlook.com (https://outlook.live.com/)
- Gmail (https://mail.google.com/)

### ページ分析・選択テキスト分析対応

- **すべての Web サイト** - 学校サイト、自治体サイト、ニュースサイトなど
- **右クリックメニュー** - 任意のページや選択テキストから即座に分析可能
- **フローティングボタン** - すべてのページで利用可能

## 使用方法

### メール分析（従来機能）

1. Web 版 Outlook または Gmail でメールを開く
2. ページ右上の「メール支援」ボタンをクリック
3. 「メール解析」ボタンで内容を分析

### ページ要約（新機能）

1. 任意の Web ページを開く
2. **方法 1**: ページ右上の「ページ分析」ボタンをクリック →「ページ要約」
3. **方法 2**: 右クリック →「このページを PTA 支援ツールで要約」

### 選択テキスト分析（新機能）

1. 任意の Web ページでテキストを選択
2. 右クリック →「選択文を PTA 支援ツールで分析」
3. 選択されたテキストの詳細分析結果を表示

## インストール方法

### 開発者モード（テスト用）

1. Edge ブラウザを開く
2. `edge://extensions/` にアクセス
3. 「開発者モード」を有効にする
4. 「展開して読み込み」をクリック
5. このフォルダ (`src/edge-extension`) を選択

### Microsoft Edge Add-ons（本格運用時）

本格運用時は Microsoft Edge Add-ons ストアでの配信を予定しています。

## 初期設定

1. 拡張機能をインストール後、ツールバーの PTA アイコンをクリック
2. 「⚙️ 設定」ボタンから設定画面を開く
3. AI プロバイダーを選択（Azure OpenAI 推奨）
4. API キーとエンドポイントを設定
5. 「🔧 接続テスト」で動作確認

### Azure OpenAI 設定例

```
プロバイダー: Azure OpenAI
エンドポイント: https://your-resource-name.openai.azure.com
APIキー: your-api-key-here
モデル: gpt-4o-mini（推奨）
```

## 使用方法

### Web 版 Outlook での使用

1. Web 版 Outlook でメールを開く
2. 画面右上に表示される「🏫 PTA 支援」ボタンをクリック
3. ダイアログから希望する機能を選択
4. AI 処理結果を確認・活用

### Gmail での使用

1. Gmail でメールを開く
2. 「🏫 PTA 支援」ボタンをクリック
3. 解析または作成機能を選択
4. 結果をコピーして活用

### ポップアップからの直接利用

1. ツールバーの PTA アイコンをクリック
2. クイック機能またはメール作成機能を選択
3. 必要な情報を入力して実行

## セキュリティと制限事項

### データの取り扱い

- メール内容は処理時のみ AI API に送信
- ローカルストレージに履歴を保存（任意設定）
- API キーは暗号化してブラウザに保存

### 制限事項

- Web メールサービスのみ対応（デスクトップ Outlook は未対応）
- AI API 呼び出し制限に準拠
- ブラウザのセキュリティポリシーに依存

## トラブルシューティング

### メール内容が取得できない

- ページが完全に読み込まれているか確認
- ブラウザをリフレッシュして PTA 支援ボタンを再表示
- 対応サービス（Outlook、Gmail）であることを確認

### API 接続エラー

- API キーとエンドポイントの設定を確認
- ネットワーク接続を確認
- Azure OpenAI サービスの状態を確認

### 機能が動作しない

- 拡張機能が有効になっているか確認
- ブラウザを再起動
- 拡張機能を再インストール

## ファイル構成

```
src/edge-extension/
├── manifest.json          # 拡張機能マニフェスト
├── background/
│   └── background.js       # バックグラウンドスクリプト
├── content/
│   ├── content.js          # コンテンツスクリプト
│   └── content.css         # スタイルシート
├── popup/
│   ├── popup.html          # ポップアップUI
│   ├── popup.js            # ポップアップ機能
│   └── popup.css           # ポップアップスタイル
├── options/
│   ├── options.html        # 設定画面
│   ├── options.js          # 設定機能
│   └── options.css         # 設定スタイル
└── assets/
    └── icons/              # アイコン類
```

## 技術仕様

- **Manifest Version**: 3
- **対応ブラウザ**: Microsoft Edge (Chromium)
- **権限**: activeTab, storage, scripting
- **API**: Azure OpenAI / OpenAI
- **フレームワーク**: Vanilla JavaScript
- **ストレージ**: Chrome Storage API

## 開発・カスタマイズ

### 開発環境

- Node.js 18 以上
- Microsoft Edge (最新版)

### ローカル開発

```bash
# ルートディレクトリで
npm run lint  # コード品質チェック

# 拡張機能フォルダで開発者モードで読み込み
```

### 機能追加

- `background/background.js`: AI 処理ロジック
- `content/content.js`: Web ページ連携
- `popup/popup.js`: UI 機能

## ライセンス

MIT License - 詳細はプロジェクトルートの LICENSE ファイルを参照

## サポート

- GitHub Issues: [takaknee/PTA](https://github.com/takaknee/PTA/issues)
- 問い合わせ: PTA Development Team

## 更新履歴

### v1.0.0 (2024-12-xx)

- 初回リリース
- Azure OpenAI API 対応
- Web 版 Outlook/Gmail 対応
- 基本的なメール解析・作成機能
- 設定画面・履歴機能
