# Edge 拡張機能テスト手順

## テスト環境構築

### 前提条件

- Microsoft Edge (最新版)
- Azure OpenAI API または OpenAI API アクセス権
- Web 版 Outlook または Gmail アカウント

### 拡張機能のインストール

1. **開発者モードでのインストール**

   ```
   1. Microsoft Edgeを開く
   2. edge://extensions/ にアクセス
   3. 左下の「開発者モード」を有効にする
   4. 「展開して読み込み」をクリック
   5. 「dist/edge-extension」フォルダを選択
   6. 拡張機能が有効になることを確認
   ```

2. **初期設定**
   ```
   1. ツールバーのPTAアイコン（🏫）をクリック
   2. 「⚙️ 設定」ボタンをクリック
   3. 以下を設定:      - プロバイダー: Azure OpenAI（推奨）
      - エンドポイント: https://your-resource.openai.azure.com
      - APIキー: your-api-key
      - モデル: gpt-4o-mini（推奨）
   4. 「🔧 接続テスト」をクリックして動作確認
   5. 「💾 設定保存」をクリック
   ```

## 機能テスト

### 1. Web 版 Outlook でのテスト

#### テスト 1: メール解析機能

```
1. https://outlook.office.com/ にアクセス
2. 任意のメールを開く
3. 画面右上の「🏫 AI支援」ボタンをクリック
4. 「📊 メール解析」ボタンをクリック
5. AI解析結果が表示されることを確認

期待結果:
- メール要約が日本語で表示される
- 重要度（高/中/低）が表示される
- 必要なアクションが提案される
- PTA観点でのコメントが表示される
```

#### テスト 2: 返信作成機能

```
1. メールを開いた状態で「🏫 AI支援」ボタンをクリック
2. 「✍️ 返信作成」ボタンをクリック
3. AI生成された返信文が表示されることを確認

期待結果:
- 元メールの内容に適した返信文が生成される
- PTA活動に適した丁寧な文面になっている
- 日本語で自然な文章になっている
```

### 2. Gmail でのテスト

#### テスト 3: Gmail 環境での動作確認

```
1. https://mail.google.com/ にアクセス
2. メールを開く
3. 「🏫 AI支援」ボタンの表示を確認
4. メール解析機能をテスト

期待結果:
- OutlookとGmailで同様の機能が動作する
- メール内容が正しく取得される
- 解析結果が適切に表示される
```

### 3. ポップアップ機能のテスト

#### テスト 4: ポップアップからの直接利用

```
1. ツールバーのPTAアイコンをクリック
2. 「作成」タブを選択
3. 以下の入力でテスト:
   - メール種類: お知らせ
   - 内容: 来月の運動会について保護者にお知らせ
4. 「📧 メール作成」をクリック

期待結果:
- 適切なお知らせメールが生成される
- PTA活動に適した文面になっている
- 結果がポップアップで表示される
```

#### テスト 5: 履歴機能

```
1. 複数回のAI処理を実行
2. 「履歴」タブを確認
3. 履歴項目をクリックして内容を確認

期待結果:
- 処理履歴が時系列で表示される
- 履歴項目から過去の結果を再確認できる
- 「クリア」ボタンで履歴を削除できる
```

### 4. 設定機能のテスト

#### テスト 6: API 設定の変更

```
1. 設定画面でプロバイダーを変更
2. OpenAI設定での動作確認
3. 不正なAPIキーでのエラー処理確認

期待結果:
- プロバイダー変更が正しく反映される
- エラー時に適切なメッセージが表示される
- 設定が永続的に保存される
```

#### テスト 7: データ管理機能

```
1. 「📤 設定エクスポート」をテスト
2. 「📋 履歴エクスポート」をテスト
3. 「🗑️ 全データ削除」をテスト

期待結果:
- JSONファイルがダウンロードされる
- 確認ダイアログが表示される
- データが適切に削除される
```

## エラーハンドリングテスト

### テスト 8: ネットワークエラー

```
1. インターネット接続を切断
2. AI機能を実行
3. エラーメッセージの確認

期待結果:
- 「ネットワークエラー」相当のメッセージが表示される
- アプリケーションがクラッシュしない
```

### テスト 9: API 制限エラー

```
1. 無効なAPIキーを設定
2. AI機能を実行
3. エラーハンドリングの確認

期待結果:
- 「API認証エラー」相当のメッセージが表示される
- 設定画面への誘導が表示される
```

### テスト 10: メール取得エラー

```
1. メールが表示されていない状態で機能を実行
2. エラーメッセージの確認

期待結果:
- 「メール内容を取得できません」メッセージが表示される
- 適切な指示が表示される
```

## パフォーマンステスト

### テスト 11: 応答時間

```
1. 各AI機能の実行時間を計測
2. 大きなメールでの処理時間確認

期待結果:
- 解析処理が30秒以内に完了する
- 作成処理が45秒以内に完了する
- ローディング表示が適切に動作する
```

### テスト 12: メモリ使用量

```
1. 長時間の使用でのメモリリーク確認
2. 大量履歴でのパフォーマンス確認

期待結果:
- メモリ使用量が適切に管理される
- 履歴が50件で制限される
```

## ブラウザ互換性テスト

### テスト 13: 異なるバージョンでの動作確認

```
1. Microsoft Edge 最新版
2. Microsoft Edge 一つ前のバージョン

期待結果:
- すべてのバージョンで正常動作する
- 互換性の問題がない
```

## セキュリティテスト

### テスト 14: データの機密性

```
1. APIキーがローカルストレージに適切に保存されることを確認
2. メール内容が永続的に保存されないことを確認

期待結果:
- APIキーが暗号化保存される
- メール内容が処理後に破棄される
```

## テスト完了チェックリスト

- [ ] Web 版 Outlook での基本機能
- [ ] Gmail での基本機能
- [ ] ポップアップからの直接利用
- [ ] 設定機能の動作
- [ ] 履歴機能の動作
- [ ] エラーハンドリング
- [ ] パフォーマンス
- [ ] セキュリティ要件
- [ ] ブラウザ互換性

## 既知の制限事項

1. **Web メールサービス限定**: デスクトップ版 Outlook には対応していません
2. **API 制限**: Azure OpenAI/OpenAI の利用制限に依存します
3. **ブラウザ依存**: Microsoft Edge (Chromium) でのみ動作します
4. **言語**: 日本語のみ対応しています

## トラブルシューティング

### よくある問題

1. **ボタンが表示されない**

   - ページをリフレッシュ
   - 拡張機能の再有効化
   - 対応サービスかどうか確認

2. **API 接続エラー**

   - API キーとエンドポイントを再確認
   - ネットワーク接続確認
   - Azure/OpenAI サービス状態確認

3. **メール内容取得失敗**
   - メールが完全に読み込まれているか確認
   - ブラウザの互換性確認
   - Web メールサービスの仕様変更確認
